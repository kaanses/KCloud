using Ardalis.Result;using AutoMapper;using KCloud.Auth.Interfaces;using KCloud.Auth.Models;using KCloud.Auth.Models.DTO;using KCloud.Auth.Models.Entity;using KCloud.Common.Helpers;using MediatR;using Microsoft.Extensions.Localization;namespace KCloud.Auth.Features.Authentication.Queries;public class GetCurrentUserQueryHandler : IRequestHandler<GetCurrentUserQuery, Result<UserDTO>>{    private readonly IUnitOfWork _unitOfWork;    private readonly IMapper _mapper;    private readonly ILogger<GetCurrentUserQueryHandler> _logger;    private readonly IStringLocalizer _localizer;    private readonly IHttpContextAccessor _httpContextAccessor;    public GetCurrentUserQueryHandler(        IUnitOfWork unitOfWork,        IMapper mapper,        ILogger<GetCurrentUserQueryHandler> logger,        IStringLocalizer localizer,         IHttpContextAccessor httpContextAccessor)    {        _unitOfWork = unitOfWork;        _mapper = mapper;        _logger = logger;        _localizer = localizer;        _httpContextAccessor = httpContextAccessor;    }    public async Task<Result<UserDTO>> Handle(GetCurrentUserQuery request, CancellationToken cancellationToken)    {        var currentUserId = CurrentUserHelper.GetUserId(_httpContextAccessor);        _logger.LogInformation("CurrentUserHelper returned: {UserId}", currentUserId);        if (currentUserId == null)        {            return Result<UserDTO>.Unauthorized();        }                var user = await _unitOfWork.Repository<User>().GetByIdAsync(currentUserId.Value, cancellationToken);        _logger.LogInformation("Retrieved user with ID: {UserId}",currentUserId);        var userDto = _mapper.Map<UserDTO>(user);        return Result<UserDTO>.Success(userDto);    }}